{% extends "base.html" %}

{% block title %}–°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è - Garmin Slack Bot{% endblock %}

{% block content %}
<div class="header">
    <h1>üìä –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h1>
    <p>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—à–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</p>
</div>

{% if success %}
<div class="status-card status-success">
    <div class="status-icon">‚úÖ</div>
    <div class="status-title">–í—Å—ë –≥–æ—Ç–æ–≤–æ!</div>
    <div class="status-description">
        –°—Ç–∞—Ç—É—Å –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
    </div>
    
    {% if battery_level %}
    <div class="battery-indicator">
        <span>–¢–µ–∫—É—â–∏–π Body Battery:</span>
        <span class="battery-level {% if battery_level < 35 %}battery-low{% elif battery_level < 70 %}battery-medium{% else %}battery-high{% endif %}">
            {{ battery_level }}%
        </span>
    </div>
    {% endif %}
    
    <div style="margin-top: 1.5rem;">
        <a href="/test-battery" class="link-btn" id="testBtn" onclick="showLoader(this)">üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–π—á–∞—Å</a>
        <a href="/clear-cache" class="link-btn" id="clearBtn" onclick="showLoader(this)">üßπ –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à</a>
    </div>
</div>
{% else %}
<div class="status-card status-error">
    <div class="status-icon">‚ùå</div>
    <div class="status-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</div>
    <div class="status-description">
        –ù–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–∫–ª—é—á–∏—Ç–µ Garmin –∏ Slack.
    </div>
    
    <div style="margin-top: 1.5rem;">
        <a href="/slack/oauth/start" class="link-btn">üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å Slack</a>
        <a href="/connect-garmin" class="link-btn">‚ö° –ü–æ–¥–∫–ª—é—á–∏—Ç—å Garmin</a>
    </div>
</div>
{% endif %}

<div style="text-align: center; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid #e1e5e9;">
    <h3 style="color: #2e2e2e; margin-bottom: 1rem;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
    <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
        <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; flex: 1; min-width: 150px;">
            <div style="font-weight: 600; color: #2e2e2e; margin-bottom: 0.5rem;">üìÖ –ò–Ω—Ç–µ—Ä–≤–∞–ª</div>
            <div style="color: #666; font-size: 0.9rem;">–ö–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç</div>
        </div>
        <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; flex: 1; min-width: 150px;">
            <div style="font-weight: 600; color: #2e2e2e; margin-bottom: 0.5rem;">üîã –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div>
            <div style="color: #666; font-size: 0.9rem;">–ü—Ä–∏ –Ω–∏–∑–∫–æ–º —É—Ä–æ–≤–Ω–µ</div>
        </div>
    </div>
</div>

<style>
@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.link-btn.loading {
    opacity: 0.7;
    pointer-events: none;
    position: relative;
}

.link-btn.loading::before {
    content: '';
    position: absolute;
    left: 8px;
    top: 50%;
    transform: translateY(-50%);
    width: 16px;
    height: 16px;
    border: 2px solid #667eea;
    border-top: 2px solid transparent;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

.link-btn.loading {
    padding-left: 32px;
}
</style>

<script>
function showLoader(element) {
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏
    element.classList.add('loading');
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç
    const originalText = element.textContent;
    
    // –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–Ω–æ–ø–∫–∏
    if (element.id === 'testBtn') {
        element.textContent = '–ü—Ä–æ–≤–µ—Ä—è–µ–º...';
    } else if (element.id === 'clearBtn') {
        element.textContent = '–û—á–∏—â–∞–µ–º...';
    }
    
    // –û—Ç–∫–ª—é—á–∞–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
    const allBtns = document.querySelectorAll('.link-btn');
    allBtns.forEach(btn => {
        if (btn !== element) {
            btn.style.opacity = '0.5';
            btn.style.pointerEvents = 'none';
        }
    });
    
    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –¥–ª—è –ø–æ–∫–∞–∑–∞ –ª–æ–∞–¥–µ—Ä–∞
    setTimeout(() => {
        window.location.href = element.href;
    }, 200);
    
    // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥
    return false;
}

// –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
window.addEventListener('pageshow', function(event) {
    if (event.persisted) {
        const allBtns = document.querySelectorAll('.link-btn');
        allBtns.forEach(btn => {
            btn.classList.remove('loading');
            btn.style.opacity = '';
            btn.style.pointerEvents = '';
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç
            if (btn.id === 'testBtn') {
                btn.textContent = 'üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–π—á–∞—Å';
            } else if (btn.id === 'clearBtn') {
                btn.textContent = 'üßπ –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à';
            }
        });
    }
});
</script>
{% endblock %} 